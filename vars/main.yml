common_os_support: ["CentOS", "Ubuntu", "Amazon"]
docker_applications: 
  - phpmyadmin

mysql_version: "8.0"
mysql_root_password: "123456"
mysql_remote: True
    
init_db: 
  mysql:
    admin: root
    users: ["zabbix"]
    password: "123456" 
    config_paths:
      - /data/apps/.env_db_mysql
      - /data/apps/.env_db_mysql_proxy

init_docker:
  zabbix:
    admin_username: Admin
    admin_password: "zabbix"
    service_after: "docker.service"
    compose_path: "/data/wwwroot/zabbix/docker-compose.yml"
    compose_commands:
      - 'sudo sed -i "s/MYSQL_ROOT_PASSWORD=.*/MYSQL_ROOT_PASSWORD=$new_password/g" /data/docker-compose.yml'
      - 'sudo sed -i "s/DB_ROOT_PASSWD=.*/DB_ROOT_PASSWD=$new_password/g" /data/docker-compose.yml'
      - 'sudo sed -i "s/SEAFILE_ADMIN_PASSWORD=.*/SEAFILE_ADMIN_PASSWORD=$new_password/g" /data/docker-compose.yml'
    volumes: 
      - /opt/seafile-mysql
      - /opt/seafile-data
    commands: 
      - sudo sudo sh -c "cat /data/config/onlyoffice.conf 1>> /opt/seafile-data/seafile/conf/seahub_settings.py"
      - sudo sed -i "s/seafile.example.com/$(curl ifconfig.me)/g" /opt/seafile-data/seafile/conf/seahub_settings.py
      - sudo sed -i "s/seafile.example.com/$(curl ifconfig.me)/g" /opt/seafile-data/seafile/conf/ccnet.conf
      - sudo docker restart seafile

init_application:
  zabbix:
    username: Admin
    password: "zabbix"
    service_after: mysql.service
    commands: 
      - sudo touch /credentials/hashpasswd.php
      - sudo echo "<?php \$options = [ 'cost' => 10, ]; echo password_hash('"$new_password"', PASSWORD_BCRYPT, \$options); ?>" > /credentials/hashpasswd.php
      - pawd=$(/usr/bin/php /credentials/hashpasswd.php)
      - mysql -uroot -p"$new_password" -h localhost -D zabbix -e "update users set passwd='$pawd' where name='Zabbix'"
